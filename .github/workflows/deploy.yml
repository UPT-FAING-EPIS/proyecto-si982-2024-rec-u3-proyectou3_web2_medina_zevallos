name: Deploy EventifyMe

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout del código
        uses: actions/checkout@v3

      - name: Configurar .NET Framework
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '4.7.2'

      - name: Configurar NuGet
        uses: nuget/setup-nuget@v1

      - name: Restaurar paquetes NuGet (.NET Framework)
        run: nuget restore Sistema/SistemaEventos/SistemaEventos.sln -PackagesDirectory Sistema/SistemaEventos/packages

      - name: Verificar paquetes restaurados
        run: Get-ChildItem -Path Sistema/SistemaEventos/packages -Recurse

      - name: Compilar solución
        run: MSBuild.exe Sistema/SistemaEventos/SistemaEventos.sln /p:Configuration=Release /p:DeployOnBuild=true /p:OutputPath=Sistema/SistemaEventos/bin/Release/publish

      - name: Publicar artefactos
        uses: actions/upload-artifact@v3
        with:
          name: build-artifacts
          path: Sistema/SistemaEventos/bin/Release/publish

  deploy:
    runs-on: windows-latest
    needs: build

    steps:
      - name: Descargar artefactos
        uses: actions/download-artifact@v3
        with:
          name: build-artifacts
          path: deploy

      - name: Desplegar en Azure (Ejemplo con FTP)
        run: |
          echo "Subiendo archivos a Azure..."
          # Aquí puedes agregar comandos para desplegar tu aplicación en Azure.
          # Por ejemplo, usando Azure CLI o FTP.
